# OSPF
开放式最短路径优先
![](./assets/2023-02-03-14-21-41.png)

距离矢量协议传递的是路由条目，链路状态协议传递的是数据库。路由所在接口的链路信息，形成数据库表。通过数据库描述的内容，每台设备以自己为根，计算出到达各个网段的路由信息。

RIP不知道完整拓扑，OSPF知道完整拓扑。

## 度量值
度量值为cost=10^8/接口带宽，参考带宽。

经过路由器时，沿途累加入接口的开销，都是回程的出接口。

## 邻居
所有的信息靠邻居关系维持。hello包是OSPF的报文，每10s组播发送一次(224.0.0.5)。

![](./assets/2023-02-03-15-08-31.png)

OSPF算出每条路由的路由信息，根据信息寻找选路，是无法汇总的。

## 工作报文
![](./assets/2023-02-03-15-14-37.png)

### Hello
先利用hello包寻找邻居，建立邻居关系，只给邻居发数据库相关路由。RIP中无邻居概念。
### Database Description
建立邻居关系后，在数据库中描述宣告的内容。
### Link-State Request
OSPF只请求需要的信息，不像RIP发送整个路由表。
### Link-State Update
根据对方请求，发送更新信息。
### Link-State Acknowledgement
确认更新的内容。

## 工作状态
邻居状态。OSPF报文根据邻居关系发送。不同的邻居状态发送相应的数据包。
![](./assets/2023-02-03-15-25-54.png)
### Down
未开启，断开连接，是初始状态。
### Init
Down状态发送Hello包，进入Init状态。<br />
路由器(R1)宣告了网段之后，从该接口组播发送Hello包，寻找邻居。
对方路由器(R2)启用OSPF后从接口听到Hello，将接收到的包内容做审核。<br />
![](./assets/2023-02-03-15-36-51.png)

1. Router-ID
真正的含义是路由器的唯一标识。可以通过配置手动分配。如果没有手动分配，会看路由器有无环回接口，如果有会选择唤回接口中最大的IP地址。若没有环回接口，会选择开启端口中的最大IP地址。**Router-ID在系统中必须唯一**。
2. 时间
Hello时间10s，死亡时间40s，死亡时间固定是Hello时间的4倍。Hello时间调整，死亡时间自动调整，死亡时间调整，Hello时间不自动调整。**建立邻居关系的路由器时间必须匹配**。
3. 区域号
OSPF涉及到区域。网络越来越大需要的


路由器的Router-ID不能相同，区域号Hello时间死亡时间要相同。审核通过后将R1写入邻居表中，此时R1相对于R2的状态从Down置为Init。<br />
Init可以理解为半连接状态。<br />